<!DOCTYPE html><html><head><title>Learn You sms2fa-rails For Much Win</title><style>body, html {
  height:100%;
  width:100%;
  padding:0;
  margin:0;
  overflow:hidden;
  background-color:#ddd;
}
.wrapper {
  height:100%;
  width:100%;
}</style><link rel="shortcut icon" href="//twilio.com/bundles/marketing/img/favicons/favicon.ico"><link rel="apple-touch-icon" href="//twilio.com/bundles/marketing/img/favicons/favicon_57.png"><link rel="apple-touch-icon" sizes="72x72" href="//twilio.com/bundles/marketing/img/favicons/favicon_72.png"><link rel="apple-touch-icon" sizes="114x114" href="//twilio.com/bundles/marketing/img/favicons/favicon_114.png"><link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css"><link rel="stylesheet" href="viewsaurus.css"></head><body><div class="wrapper"><div id="viewsaurus" data-title="Learn You sms2fa-rails For Much Win"><div class="saurus-panes"><div class="saurus-prose"><div class="saurus-prose-header"><div class="title-outer"><span class="step-title">Learn You sms2fa-rails For Much Win</span></div></div><div class="saurus-nav-buttons"><div class="saurus-nav-button nav-overview"><div class="saurus-nav-button-inner"><i class="fa fa-fw fa-list"></i></div><div class="nav-divider"></div></div><div class="saurus-nav-button nav-previous"><div class="saurus-nav-button-inner"><a href=""> <i class="fa fa-fw fa-play fa-rotate-180"></i></a></div><div class="nav-divider"></div></div><div class="saurus-nav-button nav-next clickable"><div class="saurus-nav-button-inner"><a href="#1"> <i class="fa fa-fw fa-play"></i></a></div></div><div class="saurus-next-title"><span class="next-title-inner"></span></div></div><div class="saurus-progress-bar"></div><div class="saurus-start"><p>Thanks for writing a tutorial with Viewsaurus! This example tutorial will show you the basic functionality of Viewsaurus. Click the &quot;Start&quot; button below to see how Viewsaurus works.</p><a href="#0">Start Tutorial</a></div><div class="saurus-content"><div data-title="Two Factor Authentication with Rails and Twilio" class="chapter"><div data-title="Introduction: Security" data-file="app/controllers/users_controller.rb" class="step"><h2 id="security">Security</h2>
<p>Security is a main concern for an application these days. On this tutorial we&#39;ll show how to use Twilio API to build a “<a href="https://en.wikipedia.org/wiki/Two-factor_authentication">Two Factor Authentication</a>” System.</p>
</div><div data-title="What does this thing do?" data-file="app/controllers/users_controller.rb" class="step"><h2 id="what-does-this-thing-do-">What does this thing do?</h2>
<p>This Ruby on Rails application demonstrates how to use Twilio API to implement a Two-factor authentication process. This process should improve user identity validation accuracy by ensuring user&#39;s ownership of a device along with a password.</p>
</div><div data-title="Create a new user" data-file="app/models/user.rb" class="step"><h2 id="create-a-new-user">Create a new user</h2>
<p>The first thing we’ll need to do is create the user that will be authenticated within the system. To model that we create a <code>User</code> model. It will keep information such as:</p>
<ul>
<li>password</li>
<li>email that will be used as identifier</li>
<li>phone number that will be used to validate its authenticity</li>
<li>boolean to check if phone number was already verified</li>
</ul>
</div><div data-title="Configuring Twilio Client" data-file="lib/message_sender.rb" class="step"><h2 id="configuring-twilio-client">Configuring Twilio Client</h2>
<p>To send the confirmation SMS we need to create a Twilio REST API client that can be used to send SMS and MMS messages. The client requires your Twilio account credentials (an account SID and auth token), which can be found in the account portal.</p>
<p>Next all we need to do is call <code>messages.create</code> on the client object in order to send our message. The Twilio Message API call requires a &#39;From&#39; and &#39;To&#39; parameter, and either a &#39;Body&#39; or a &#39;MediaUrl&#39; attribute (or both).</p>
<p>These nine lines of code are all you need to send an SMS in Rails.</p>
</div><div data-title="Sending Verification Code" data-file="app/controllers/users_controller.rb" data-highlight="15-24" class="step"><h2 id="sending-verification-code">Sending Verification Code</h2>
<p>The controller will send a 6-digit random code to the user&#39;s phone.  He will need to use it to confirm that the provided phone number is correct. Since at this point, we don’t have that confirmation yet, we create the user but we don’t perform its authentication at that moment. We just redirect him to the page where he’ll be able to input the validation code.</p>
</div><div data-title="Confirm phone number" data-file="app/controllers/confirmations_controller.rb" data-highlight="6-18" class="step"><h2 id="confirm-phone-number">Confirm phone number</h2>
<p>After the user has input the validation code, the system will check if the verification code provided by the user matches the one 
that we have persisted. In the cases where it matches, we&#39;ll confirm the phone number using <code>user#confirm!</code>. After that we set the 
user’s authenticated session attribute to <code>true</code> and redirect him to the secret content.</p>
</div><div data-title="Sign in with your new user" data-file="app/controllers/sessions_controller.rb" data-highlight="5-17" class="step"><h2 id="sign-in-with-your-new-user">Sign in with your new user</h2>
<p>On the <em>sign in</em> page we call <code>@user.authenticate(params[:password])</code> to ask bcrypt to hash and validate the provided password against 
the persisted one. Since we haven’t finish the authentication process yet, we set <code>session[:authenticated] = false</code> to flag that
this user is not authenticated yet.
Last step is to send a confirmation code over SMS and redirect to code confirmation page.</p>
</div><div data-title="Verify phone ownership" data-file="app/controllers/confirmations_controller.rb" data-highlight="6-18" class="step"><h2 id="verify-phone-ownership">Verify phone ownership</h2>
<p>After sending the code, we need to make sure that user received it correctly and has his phone. We then ask him to input the code 
and validate against the given one, which is a copy of what we have just sent.</p>
</div><div data-title="Ensuring that content requires authentication" data-file="app/controllers/application_controller.rb" data-highlight="6-12" class="step"><h2 id="ensuring-that-content-requires-authentication">Ensuring that content requires authentication</h2>
<p>In order to ensure that a user provided both factors (password and verification code) we check the session for <code>:user_id</code> and 
<code>:authenticated</code> attributes. These session attributes are set during the password matchind and the SMS authentication processes.</p>
<p>We added a <code>before_action</code> on the controller responsible for rendering authenticated content and that will guarantee that user is authorized for every request.</p>
</div><div class="step"><h2 id="where-to-next-">Where to next?</h2>
<p>That&#39;s it! We&#39;ve just implemented an SMS Two Factor Authenticated application. If you&#39;re a
Rails developer working with Twilio, you might want to check out these other tutorials.</p>
<p><a href="//www.twilio.com/docs/tutorials/walkthrough/workflow-automation/ruby/rails"><strong>Workflow Automation</strong></a></p>
<p>Increase your rate of response by automating the workflows that are key
to your business. In this tutorial, learn how to build a ready-for-scale
automated SMS workflow, for a vacation rental company.</p>
<p><a href="//www.twilio.com/docs/tutorials/walkthrough/masked-numbers/ruby/rails"><strong>Masked Numbers</strong></a></p>
<p>Protect your users&#39; privacy by anonymously connecting them with Twilio
Voice and SMS. Learn how to create disposable phone numbers on-demand,
so two users can communicate without exchanging personal information.</p>
<h3 id="did-this-help-">Did this help?</h3>
<p>Thanks for checking out this tutorial! If you have any feedback
to share with us, we&#39;d love to hear it. Tweet
<a href="//twitter.com/twilio">@twilio</a> to let us know what you
think.</p>
</div></div>
<div class="saurus-files" style="display:none;"><textarea class="saurus-file" data-file="app/controllers/users_controller.rb" data-mode="ruby">Y2xhc3MgVXNlcnNDb250cm9sbGVyIDwgQXBwbGljYXRpb25Db250cm9sbGVyCiAgQVRUUklCVVRFX1dISVRFTElTVCA9IFsKICAgIDpmaXJzdF9uYW1lLAogICAgOmxhc3RfbmFtZSwKICAgIDplbWFpbCwKICAgIDpwaG9uZV9udW1iZXIsCiAgICA6cGFzc3dvcmRfY29uZmlybWF0aW9uLAogICAgOnBhc3N3b3JkCiAgXQoKICBkZWYgbmV3CiAgICBAdXNlciA9IFVzZXIubmV3CiAgZW5kCgogIGRlZiBjcmVhdGUKICAgIEB1c2VyID0gVXNlci5uZXcodXNlcl9wYXJhbXMpCiAgICBpZiBAdXNlci5zYXZlCiAgICAgIHNlc3Npb25bOnVzZXJfaWRdID0gQHVzZXIuaWQKICAgICAgQ29uZmlybWF0aW9uU2VuZGVyLnNlbmRfY29uZmlybWF0aW9uX3RvKEB1c2VyKQogICAgICByZWRpcmVjdF90byBuZXdfY29uZmlybWF0aW9uX3BhdGgKICAgIGVsc2UKICAgICAgcmVuZGVyIDpuZXcKICAgIGVuZAogIGVuZAoKICBwcml2YXRlCgogIGRlZiB1c2VyX3BhcmFtcwogICAgcGFyYW1zLnJlcXVpcmUoOnVzZXIpLnBlcm1pdCgqQVRUUklCVVRFX1dISVRFTElTVCkKICBlbmQKZW5kCg==</textarea>
<textarea class="saurus-file" data-file="app/models/user.rb" data-mode="ruby">cmVxdWlyZSAncGhvbnlfcmFpbHMnCgpjbGFzcyBVc2VyIDwgQWN0aXZlUmVjb3JkOjpCYXNlCiAgaGFzX3NlY3VyZV9wYXNzd29yZAoKICB2YWxpZGF0ZXMgOmZpcnN0X25hbWUsCiAgICAgICAgICAgIDpsYXN0X25hbWUsCiAgICAgICAgICAgIDplbWFpbCwKICAgICAgICAgICAgOnBob25lX251bWJlciwKICAgICAgICAgICAgOnBhc3N3b3JkX2RpZ2VzdCwgcHJlc2VuY2U6IHRydWUKCiAgdmFsaWRhdGVzX3VuaXF1ZW5lc3Nfb2YgOmVtYWlsCgogIGRlZiBjb25maXJtIQogICAgc2VsZi5jb25maXJtZWQgPSB0cnVlCiAgICBzYXZlIQogIGVuZAoKICBkZWYgcHJldHR5X3Bob25lX251bWJlcgogICAgcGhvbmVfbnVtYmVyLnBob255X2Zvcm1hdHRlZChmb3JtYXQ6IDppbnRlcm5hdGlvbmFsLCBzcGFjZXM6ICcgJykKICBlbmQKZW5kCg==</textarea>
<textarea class="saurus-file" data-file="lib/message_sender.rb" data-mode="ruby">bW9kdWxlIE1lc3NhZ2VTZW5kZXIKICBkZWYgc2VsZi5zZW5kX2NvZGUocGhvbmVfbnVtYmVyLCBjb2RlKQogICAgYWNjb3VudF9zaWQgPSBFTlZbJ1RXSUxJT19BQ0NPVU5UX1NJRCddCiAgICBhdXRoX3Rva2VuICA9IEVOVlsnVFdJTElPX0FVVEhfVE9LRU4nXQogICAgY2xpZW50ID0gVHdpbGlvOjpSRVNUOjpDbGllbnQubmV3KGFjY291bnRfc2lkLCBhdXRoX3Rva2VuKQoKICAgIG1lc3NhZ2UgPSBjbGllbnQubWVzc2FnZXMuY3JlYXRlKAogICAgICBmcm9tOiAgRU5WWydUV0lMSU9fTlVNQkVSJ10sCiAgICAgIHRvOiAgICBwaG9uZV9udW1iZXIsCiAgICAgIGJvZHk6ICBjb2RlCiAgICApCgogICAgbWVzc2FnZS5zdGF0dXMgPT0gJ3F1ZXVlZCcKICBlbmQKZW5kCg==</textarea>
<textarea class="saurus-file" data-file="app/controllers/confirmations_controller.rb" data-mode="ruby">Y2xhc3MgQ29uZmlybWF0aW9uc0NvbnRyb2xsZXIgPCBBcHBsaWNhdGlvbkNvbnRyb2xsZXIKICBkZWYgbmV3CiAgICBAdXNlciA9IFVzZXIuZmluZChzZXNzaW9uWzp1c2VyX2lkXSkKICBlbmQKCiAgZGVmIGNyZWF0ZQogICAgQHVzZXIgPSBVc2VyLmZpbmQgcGFyYW1zWzp1c2VyX2lkXQogICAgaWYgQHVzZXIudmVyaWZpY2F0aW9uX2NvZGUgPT0gcGFyYW1zWzp2ZXJpZmljYXRpb25fY29kZV0KICAgICAgQHVzZXIuY29uZmlybSEKICAgICAgc2Vzc2lvbls6YXV0aGVudGljYXRlZF0gPSB0cnVlCgogICAgICBmbGFzaFs6bm90aWNlXSA9ICJXZWxjb21lICN7QHVzZXIuZmlyc3RfbmFtZX0uIFRoZSBBZHZlbnR1cmUgQmVnaW5zISIKICAgICAgcmVkaXJlY3RfdG8gc2VjcmV0c19wYXRoCiAgICBlbHNlCiAgICAgIGZsYXNoLm5vd1s6ZXJyb3JdID0gIlZlcmlmaWNhdGlvbiBjb2RlIGlzIGluY29ycmVjdC4iCiAgICAgIHJlbmRlciA6bmV3CiAgICBlbmQKICBlbmQKZW5kCg==</textarea>
<textarea class="saurus-file" data-file="app/controllers/sessions_controller.rb" data-mode="ruby">Y2xhc3MgU2Vzc2lvbnNDb250cm9sbGVyIDwgQXBwbGljYXRpb25Db250cm9sbGVyCiAgZGVmIG5ldwogIGVuZAoKICBkZWYgY3JlYXRlCiAgICBAdXNlciA9IFVzZXIuZmluZF9ieShlbWFpbDogcGFyYW1zWzplbWFpbF0pCiAgICBpZiBAdXNlciAmJiBAdXNlci5hdXRoZW50aWNhdGUocGFyYW1zWzpwYXNzd29yZF0pCiAgICAgIHNlc3Npb25bOnVzZXJfaWRdID0gQHVzZXIuaWQKICAgICAgc2Vzc2lvbls6YXV0aGVudGljYXRlZF0gPSBmYWxzZQogICAgICBDb25maXJtYXRpb25TZW5kZXIuc2VuZF9jb25maXJtYXRpb25fdG8gQHVzZXIKCiAgICAgIHJlZGlyZWN0X3RvIG5ld19jb25maXJtYXRpb25fcGF0aAogICAgZWxzZQogICAgICBmbGFzaC5ub3dbOmVycm9yXSA9ICJXcm9uZyB1c2VyL3Bhc3N3b3JkLiIKICAgICAgcmVuZGVyIDpuZXcKICAgIGVuZAogIGVuZAoKICBkZWYgZGVzdHJveQogICAgc2Vzc2lvbls6dXNlcl9pZF0gPSBuaWwKICAgIHNlc3Npb25bOmF1dGhlbnRpY2F0ZWRdID0gbmlsCiAgICBmbGFzaC5ub3dbOm5vdGljZV0gPSAiU2VlIHlvdSBzb29uISIKICAgIHJlbmRlciA6bmV3CiAgZW5kCmVuZAo=</textarea>
<textarea class="saurus-file" data-file="app/controllers/application_controller.rb" data-mode="ruby">Y2xhc3MgQXBwbGljYXRpb25Db250cm9sbGVyIDwgQWN0aW9uQ29udHJvbGxlcjo6QmFzZQogICMgUHJldmVudCBDU1JGIGF0dGFja3MgYnkgcmFpc2luZyBhbiBleGNlcHRpb24uCiAgIyBGb3IgQVBJcywgeW91IG1heSB3YW50IHRvIHVzZSA6bnVsbF9zZXNzaW9uIGluc3RlYWQuCiAgcHJvdGVjdF9mcm9tX2Zvcmdlcnkgd2l0aDogOmV4Y2VwdGlvbgoKICBkZWYgYXV0aGVudGljYXRlZD8KICAgIHNlc3Npb25bOnVzZXJfaWRdICYmIHNlc3Npb25bOmF1dGhlbnRpY2F0ZWRdCiAgZW5kCgogIGRlZiBhdXRoZW50aWNhdGUhCiAgICByZWRpcmVjdF90byBuZXdfc2Vzc2lvbl9wYXRoIGFuZCByZXR1cm4gdW5sZXNzIGF1dGhlbnRpY2F0ZWQ/CiAgZW5kCgogIGhlbHBlcl9tZXRob2QgOmF1dGhlbnRpY2F0ZWQ/CmVuZAo=</textarea>
</div>
</div><div class="saurus-overview"><ul></ul></div></div><div class="saurus-code"><div class="file-path"><span class="crumb-container"></span><i class="fa fa-fw fa-folder"></i></div><div class="saurus-editor"></div></div><div class="saurus-explorer"><div class="saurus-file-list"></div><a href="https://github.com/&lt;your GitHub username&gt;/&lt;GitHub repo name&gt;" target="_blank" class="explorer-get-code"> <i class="fa fa-lg fa-github-square"> </i>View Code on GitHub</a></div></div></div></div><script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script><script src="//cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js"></script><script src="//cdnjs.cloudflare.com/ajax/libs/backbone.js/1.1.2/backbone-min.js"></script><script src="ace/ace.js"></script><script src="ace/theme-monokai.js"></script><script src="viewsaurus.js"></script></body></html>